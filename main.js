(()=>{"use strict";var e=document.querySelector(".page"),t=e.querySelector(".popup_profile"),n=e.querySelector(".popup_add"),o=e.querySelector(".popup_avatar"),r=e.querySelector(".profile"),c="Сохранение...",a="",i=function(e){e.textContent!==c?(a=e.textContent,e.textContent=c):e.textContent=a},s=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u),e.addEventListener("click",d)},l=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",u),e.removeEventListener("click",d)},u=function(t){if("Escape"===t.key){var n=e.querySelector(".popup_opened");l(n)}},d=function(e){var t=e.target.classList.contains("popup"),n=e.target.classList.contains("popup__close-btn");(t||n)&&l(e.currentTarget)},p={baseUrl:"https://nomoreparties.co/v1/plus-cohort-25",headers:{authorization:"ff2add9f-c238-4c93-a34e-b492cfd1be94","Content-Type":"application/json"}},_=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},f=e.querySelector(".elements"),v=e.querySelector("#card").content,m=e.querySelector(".popup_view"),h=m.querySelector(".popup__view-image"),y=m.querySelector(".popup__view-title"),S=function(e){var t=function(e){var t=v.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__image"),o=t.querySelector(".element__likes"),c=t.querySelector(".element__del-button");return r.dataset.userId===e.owner._id&&(c.classList.remove("element__del-button_disabled"),c.addEventListener("click",(function(){var e;(e=t.dataset.cardId,fetch("".concat(p.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:p.headers}).then(_)).then((function(e){console.log(e),t.remove()})).catch((function(e){console.log(e)}))}))),t.dataset.cardId=e._id,n.src=e.link,n.alt=e.name,o.textContent=e.likes.length,t.querySelector(".element__title").textContent=e.name,e.likes.forEach((function(e){e._id===r.dataset.userId&&t.querySelector(".element__like").classList.add("element__like_active")})),t.querySelector(".element__like").addEventListener("click",(function(e){var n;e.target.classList.toggle("element__like_active"),e.target.classList.contains("element__like_active")?function(e){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:p.headers}).then(_)}(t.dataset.cardId).then((function(e){o.textContent=e.likes.length})).catch((function(e){console.log(e)})):(n=t.dataset.cardId,fetch("".concat(p.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:p.headers}).then(_)).then((function(e){o.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),n.addEventListener("click",(function(){h.src=e.link,h.alt=e.name,y.textContent=e.name,s(m)})),t}(e);f.prepend(t)};function b(e){var t=e.getAttribute("id");return document.getElementById("".concat(t,"-error"))}function q(e,t,n){e.classList.remove(n.inputErrorClass),t.textContent="",t.classList.remove(n.errorClass)}function C(e,t){var n=e.querySelector(t.submitButtonSelector);e.checkValidity()?(n.classList.remove(t.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled","disabled"))}function E(e,t){var n=e.querySelector(t.formSelector);n.querySelectorAll(t.inputSelector).forEach((function(e){q(e,b(e),t)})),C(n,t)}var L=e.querySelector(".profile__title"),g=e.querySelector(".profile__subtitle"),k=e.querySelector(".profile__avatar"),x=e.querySelector(".profile__avatar-button"),U=e.querySelector(".profile__edit-button"),A=e.querySelector(".profile__add-button"),I=o.querySelector(".popup__form"),T=o.querySelector(".popup__input_type_link"),w=o.querySelector(".popup__submit-btn"),B=t.querySelector(".popup__form"),P=t.querySelector(".popup__input_type_name"),N=t.querySelector(".popup__input_type_about"),O=t.querySelector(".popup__submit-btn"),j=n.querySelector(".popup__form"),D=n.querySelector(".popup__input_type_place"),J=n.querySelector(".popup__input_type_link"),M=n.querySelector(".popup__submit-btn");fetch("".concat(p.baseUrl,"/users/me"),{headers:p.headers}).then(_).then((function(e){var t;t=e,L.textContent=t.name,g.textContent=t.about,k.src=t.avatar,r.dataset.userId=t._id,fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then(_).then((function(e){e.reverse().forEach(S)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),x.addEventListener("click",(function(){I.reset(),E(o,V),s(o)})),U.addEventListener("click",(function(){B.reset(),E(t,V),s(t),P.value=L.textContent,N.value=g.textContent})),A.addEventListener("click",(function(){j.reset(),E(n,V),s(n)})),I.addEventListener("submit",(function(){var e;i(w),(e=T.value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:e})}).then(_)).then((function(e){k.src=e.avatar,l(o)})).catch((function(e){console.log(e)})).finally((function(){i(w)}))})),B.addEventListener("submit",(function(){var e,n;i(O),(e=P.value,n=N.value,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:e,about:n})}).then(_)).then((function(e){L.textContent=e.name,g.textContent=e.about,k.src=e.avatar,l(t)})).catch((function(e){console.log(e)})).finally((function(){i(O)}))})),j.addEventListener("submit",(function(){var e,t;i(M),(e=D.value,t=J.value,fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:e,link:t})}).then(_)).then((function(e){S(e),l(n)})).catch((function(e){console.log(e)})).finally((function(){i(M)}))}));var V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"};!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){e.querySelectorAll(t.inputSelector).forEach((function(n){n.addEventListener("input",(function(n){!function(e,t,n){var o=e.target;(function(e,t,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?q(e,t,n):function(e,t,n){e.classList.add(n.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(n.errorClass)}(e,t,n)})(o,b(o),n),C(t,n)}(n,e,t)}))}))}(t,e)}))}(V)})();