(()=>{"use strict";var e=document.querySelector(".page"),t=e.querySelector(".popup_profile"),n=e.querySelector(".popup_add"),o=e.querySelector(".popup_avatar"),r=e.querySelector(".profile"),c=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",s),e.addEventListener("click",i)},a=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",s),e.removeEventListener("click",i)},s=function(t){if("Escape"===t.key){var n=e.querySelector(".popup_opened");a(n)}},i=function(e){var t=e.target.classList.contains("popup"),n=e.target.classList.contains("popup__close-btn");(t||n)&&a(e.currentTarget)},u={baseUrl:"https://nomoreparties.co/v1/plus-cohort-25",headers:{authorization:"ff2add9f-c238-4c93-a34e-b492cfd1be94","Content-Type":"application/json"}},l=e.querySelector(".elements"),d=e.querySelector("#card").content,p=e.querySelector(".popup_view"),_=p.querySelector(".popup__view-image"),f=p.querySelector(".popup__view-title"),m=function(e){var t=function(e){var t=d.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__image"),o=t.querySelector(".element__likes"),a=t.querySelector(".element__del-button");return r.dataset.userId===e.owner._id&&(a.classList.remove("element__del-button_disabled"),a.addEventListener("click",(function(){var e;(e=t.dataset.cardId,fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),t.remove()})).catch((function(e){console.log(e)}))}))),t.dataset.cardId=e._id,n.src=e.link,n.alt=e.name,o.textContent=e.likes.length,t.querySelector(".element__title").textContent=e.name,e.likes.forEach((function(e){e._id===r.dataset.userId&&t.querySelector(".element__like").classList.add("element__like_active")})),t.querySelector(".element__like").addEventListener("click",(function(e){var n;e.target.classList.toggle("element__like_active"),e.target.classList.contains("element__like_active")?function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t.dataset.cardId).then((function(e){o.textContent=e.likes.length})).catch((function(e){console.log(e)})):(n=t.dataset.cardId,fetch("".concat(u.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){o.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),n.addEventListener("click",(function(){_.src=e.link,_.alt=e.name,f.textContent=e.name,c(p)})),t}(e);l.prepend(t)};function v(e){var t=e.getAttribute("id");return document.getElementById("".concat(t,"-error"))}function h(e,t,n){e.classList.remove(n.inputErrorClass),t.textContent="",t.classList.remove(n.errorClass)}function y(e,t){var n=e.querySelector(t.submitButtonSelector);e.checkValidity()?(n.classList.remove(t.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled","disabled"))}function S(e,t){var n=e.querySelector(t.formSelector);n.querySelectorAll(t.inputSelector).forEach((function(e){h(e,v(e),t)})),y(n,t)}var b=e.querySelector(".profile__title"),q=e.querySelector(".profile__subtitle"),k=e.querySelector(".profile__avatar"),C=e.querySelector(".profile__avatar-button"),E=e.querySelector(".profile__edit-button"),L=e.querySelector(".profile__add-button"),g=o.querySelector(".popup__form"),j=o.querySelector(".popup__input_type_link"),x=o.querySelector(".popup__submit-btn"),P=t.querySelector(".popup__form"),U=t.querySelector(".popup__input_type_name"),A=t.querySelector(".popup__input_type_about"),I=t.querySelector(".popup__submit-btn"),T=n.querySelector(".popup__form"),w=n.querySelector(".popup__input_type_place"),B=n.querySelector(".popup__input_type_link"),N=n.querySelector(".popup__submit-btn");fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){b.textContent=e.name,q.textContent=e.about,k.src=e.avatar,r.dataset.userId=e._id})).catch((function(e){console.log(e)})),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.reverse().forEach(m)})).catch((function(e){console.log(e)})),C.addEventListener("click",(function(){g.reset(),S(o,M),c(o),j.value=k.src})),E.addEventListener("click",(function(){P.reset(),S(t,M),c(t),U.value=b.textContent,A.value=q.textContent})),L.addEventListener("click",(function(){T.reset(),S(n,M),c(n)}));var O="Сохранение...",D="";function J(e){e.textContent!==O?(D=e.textContent,e.textContent=O):e.textContent=D}g.addEventListener("submit",(function(){var e;J(x),(e=j.value,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){k.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){J(x)})),a(o)})),P.addEventListener("submit",(function(){var e,n;J(I),(e=U.value,n=A.value,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){b.textContent=e.name,q.textContent=e.about,k.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){J(I)})),a(t)})),T.addEventListener("submit",(function(){var e,t;J(N),(e=w.value,t=B.value,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){m(e)})).catch((function(e){console.log(e)})).finally((function(){J(N)})),a(n)}));var M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"};!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){e.querySelectorAll(t.inputSelector).forEach((function(n){n.addEventListener("input",(function(n){!function(e,t,n){var o=e.target;(function(e,t,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?h(e,t,n):function(e,t,n){e.classList.add(n.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(n.errorClass)}(e,t,n)})(o,v(o),n),y(t,n)}(n,e,t)}))}))}(t,e)}))}(M)})();